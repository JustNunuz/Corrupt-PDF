from reportlab.pdfgen import canvas
from PyPDF2 import PdfReader, PdfWriter
from PyPDF2.generic import DictionaryObject, NameObject, TextStringObject

# Step 1: Define the URL you want to open when the PDF is opened
url = "https://www.example.com"

# Step 2: Create a PDF with ReportLab
pdf_path = "ExploitActions/open_url_on_open.pdf"
c = canvas.Canvas(pdf_path)
c.drawString(100, 750, "This PDF opens a specified URL on open!")
c.showPage()
c.save()

# Step 3: Add JavaScript action to open the specified URL
def add_open_action(pdf_path, url):
    # Read the existing PDF
    reader = PdfReader(pdf_path)
    writer = PdfWriter()
    writer.append_pages_from_reader(reader)

    # Define the JavaScript action dictionary
    js_code = f"""
    app.launchURL("{url}", true);
    """
    js_action = DictionaryObject()
    js_action.update({
        NameObject("/Type"): NameObject("/Action"),
        NameObject("/S"): NameObject("/JavaScript"),
        NameObject("/JS"): TextStringObject(js_code)
    })

    # Add the action to the PDF catalog
    writer._root_object.update({
        NameObject("/OpenAction"): js_action
    })

    # Save the modified PDF
    with open("ExploitActions/open_url_with_action.pdf", "wb") as f_out:
        writer.write(f_out)
    print(f"PDF created with an open action to {url}")

# Step 4: Add the open action to the PDF
add_open_action(pdf_path, url)
